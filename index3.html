<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Ultra Dosa Sentinel</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ‘ï¸</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700;900&family=Noto+Sans+KR:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-deep: #0B0E14;
            --text-main: #e0e0e0;
            --primary-purple: #b026ff;
            --primary-cyan: #00f2ff;
            --accent-gold: #ffd700;
            --glass-panel: rgba(20, 15, 35, 0.75);
            --border-glow: rgba(176, 38, 255, 0.5);
            --font-ancient: 'Cinzel', serif;
            --font-tech: 'Orbitron', sans-serif;
            --font-body: 'Noto Sans KR', sans-serif;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            background-color: var(--bg-deep); color: var(--text-main); font-family: var(--font-body); 
            overflow-x: hidden; min-height: 100vh; position: relative; 
        }
        .stars {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
            background: #000 radial-gradient(2px 2px at 20px 30px, #eee, rgba(0,0,0,0)), 
                        radial-gradient(2px 2px at 40px 70px, #fff, rgba(0,0,0,0));
            background-size: 200px 200px;
        }
        .twinkling {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at 50% 50%, rgba(176, 38, 255, 0.1), transparent 70%);
            animation: pulse 5s infinite;
        }
        @keyframes pulse { 0% { opacity: 0.3; } 50% { opacity: 0.6; } 100% { opacity: 0.3; } }

        .site-header { text-align: center; padding: 60px 20px; }
        .site-title { font-family: var(--font-ancient); font-size: 3rem; color: var(--accent-gold); text-shadow: 0 0 20px rgba(255, 215, 0, 0.5); letter-spacing: 2px; margin-bottom: 10px; }
        .site-subtitle { font-family: var(--font-tech); color: var(--primary-cyan); font-size: 0.9rem; letter-spacing: 3px; opacity: 0.8; }

        .main-container { max-width: 900px; margin: 0 auto; padding: 20px; position: relative; z-index: 10; }
        .screen { display: none; animation: fadeScale 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .screen.active { display: block; }
        @keyframes fadeScale { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        .selection-content { text-align: center; }
        .section-title { font-family: var(--font-ancient); font-size: 1.8rem; margin-bottom: 10px; color: #fff; }
        .section-desc { color: #888; margin-bottom: 40px; }
        .method-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .method-card { background: var(--glass-panel); border: 1px solid rgba(255,255,255,0.1); border-radius: 4px; padding: 40px 20px; cursor: pointer; transition: 0.4s; }
        .method-card:hover { transform: translateY(-5px); box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .saju-card:hover { border-color: var(--primary-purple); box-shadow: 0 0 30px rgba(176,38,255,0.2); }
        .astro-card:hover { border-color: var(--primary-cyan); box-shadow: 0 0 30px rgba(0,242,255,0.2); }
        .card-icon { font-size: 3rem; margin-bottom: 20px; }
        .card-title { font-family: var(--font-tech); font-size: 1.5rem; margin-bottom: 5px; color: #fff; }
        .card-button { background: transparent; border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 10px 30px; font-family: var(--font-tech); transition: 0.3s; pointer-events: none; }
        .saju-card:hover .card-button { background: var(--primary-purple); border-color: var(--primary-purple); }
        .astro-card:hover .card-button { background: var(--primary-cyan); border-color: var(--primary-cyan); color: #000; }

        .form-container { background: rgba(10, 10, 20, 0.9); border: 1px solid #333; padding: 40px; border-radius: 4px; }
        .saju-theme { border-top: 3px solid var(--primary-purple); }
        .astro-theme { border-top: 3px solid var(--primary-cyan); }
        .form-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px; }
        .form-title { font-family: var(--font-tech); font-size: 1.8rem; color: #fff; }
        .form-label { display: block; font-family: var(--font-tech); font-size: 0.8rem; color: #888; margin-bottom: 8px; }
        .form-input, .form-select { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 12px; font-size: 1rem; outline: none; }
        .form-input:focus, .form-select:focus { border-color: var(--accent-gold); }
        .form-group { margin-bottom: 25px; }
        .button-group, .select-group { display: flex; gap: 10px; }
        .select-group select { flex: 1; }
        .option-button { flex: 1; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid #333; color: #aaa; cursor: pointer; font-family: var(--font-tech); }
        .option-button.active { background: rgba(255,255,255,0.1); border-color: var(--accent-gold); color: var(--accent-gold); }
        .checkbox-label { display: flex; align-items: center; gap: 10px; cursor: pointer; color: #ccc; font-size: 0.9rem; margin-top: 10px; }
        .checkbox-label input { width: 16px; height: 16px; accent-color: var(--accent-gold); }
        .form-hint { font-size: 0.8rem; color: #00f2ff; margin-top: 5px; }
        .submit-button { width: 100%; padding: 15px; margin-top: 20px; font-family: var(--font-tech); font-weight: bold; cursor: pointer; border: none; transition: 0.3s; }
        .saju-btn { background: var(--primary-purple); color: #fff; }
        .astro-btn { background: var(--primary-cyan); color: #000; }
        .submit-button:hover { filter: brightness(1.2); }
        .back-button { background: none; border: none; color: #666; cursor: pointer; font-family: var(--font-tech); margin-bottom: 20px; }
        .back-button:hover { color: #fff; }

        .hud-interface { border: 1px solid var(--border-glow); background: rgba(5, 5, 10, 0.95); padding: 20px; position: relative; box-shadow: 0 0 50px rgba(176, 38, 255, 0.1); min-height: 600px; display: flex; flex-direction: column; }
        .result-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 15px; margin-bottom: 15px; }
        .result-title { font-family: var(--font-tech); color: var(--accent-gold); letter-spacing: 2px; }
        .new-analysis-button { background: transparent; border: 1px solid #555; color: #888; padding: 5px 15px; cursor: pointer; font-family: var(--font-tech); font-size: 0.8rem; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 20px; margin-bottom: 20px; background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px); background-size: 20px 20px; }
        .ai-message { color: #e0e0e0; margin-bottom: 20px; white-space: pre-wrap; border-left: 3px solid var(--accent-gold); padding-left: 15px; }
        .user-message { background: rgba(255,255,255,0.1); padding: 10px 15px; border-radius: 10px; color: var(--primary-cyan); text-align: right; width: fit-content; margin-left: auto; margin-bottom: 20px; }
        .chat-input-area { display: flex; gap: 10px; border-top: 1px solid #333; padding-top: 15px; }
        .chat-input { flex: 1; background: #111; border: 1px solid #444; color: #fff; padding: 12px; }
        .send-button { background: var(--accent-gold); border: none; color: #000; padding: 0 25px; font-weight: bold; cursor: pointer; font-family: var(--font-tech); }
        .hud-corner { position: absolute; width: 20px; height: 20px; border: 2px solid var(--accent-gold); }
        .top-left { top: -2px; left: -2px; border-right: none; border-bottom: none; }
        .top-right { top: -2px; right: -2px; border-left: none; border-bottom: none; }
        .bottom-left { bottom: -2px; left: -2px; border-right: none; border-top: none; }
        .bottom-right { bottom: -2px; right: -2px; border-left: none; border-top: none; }
        @media (max-width: 768px) { .method-grid { grid-template-columns: 1fr; } .site-title { font-size: 2rem; } }
    </style>
</head>
<body>
    
    <div class="stars"></div>
    <div class="twinkling"></div>
    
    <header class="site-header">
        <h1 class="site-title">AI ULTRA DOSA SENTINEL</h1>
        <p class="site-subtitle">The Convergence of Ancient Wisdom & Future Intelligence</p>
    </header>
    
    <main class="main-container">
        <section id="selection-screen" class="screen active">
            <div class="selection-content">
                <h2 class="section-title">CHOOSE YOUR DESTINY</h2>
                <p class="section-desc">ìš´ëª…ì„ í•´ì„í•  í”„ë¡œí† ì½œì„ ì„ íƒí•˜ì‹­ì‹œì˜¤</p>
                <div class="method-grid">
                    <div class="method-card saju-card" onclick="selectMethod('saju')">
                        <div class="card-icon">ğŸ”®</div>
                        <h3 class="card-title">SAJU PROTOCOL</h3>
                        <ul class="card-features"><li>ì‚¬ì£¼íŒ”ì (Four Pillars) í•´ì„</li><li>ì˜¤í–‰ (Five Elements) ê· í˜•</li></ul>
                        <button class="card-button saju-btn">INITIALIZE â–¶</button>
                    </div>
                    <div class="method-card astro-card" onclick="selectMethod('astrology')">
                        <div class="card-icon">ğŸŒŒ</div>
                        <h3 class="card-title">ASTRO PROTOCOL</h3>
                        <ul class="card-features"><li>ì¶œìƒ ì°¨íŠ¸ (Natal Chart) ë””ì½”ë”©</li><li>í–‰ì„± ë°°ì¹˜ì™€ í•˜ìš°ìŠ¤ ë¶„ì„</li></ul>
                        <button class="card-button astro-btn">INITIALIZE â–¶</button>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="saju-screen" class="screen">
            <button class="back-button" onclick="backToSelection()">â—€ ABORT</button>
            <div class="form-container saju-theme">
                <div class="form-header"><h2 class="form-title">SAJU SEQUENCE</h2></div>
                <form id="saju-form">
                    <div class="form-group"><label class="form-label">CODENAME</label><input type="text" id="saju-name" class="form-input" required></div>
                    <div class="form-group"><label class="form-label">GENDER</label>
                        <div class="button-group" id="saju-gender-group">
                            <button type="button" class="option-button active" data-value="male">MALE</button>
                            <button type="button" class="option-button" data-value="female">FEMALE</button>
                        </div>
                    </div>
                    <div class="form-group"><label class="form-label">CALENDAR</label>
                        <div class="button-group" id="saju-calendar-group">
                            <button type="button" class="option-button active" data-value="solar">SOLAR (ì–‘ë ¥)</button>
                            <button type="button" class="option-button" data-value="lunar">LUNAR (ìŒë ¥)</button>
                        </div>
                    </div>
                    <div class="form-group"><label class="form-label">DATE</label>
                        <div class="select-group">
                            <select id="saju-year" class="form-select" required></select>
                            <select id="saju-month" class="form-select" required></select>
                            <select id="saju-day" class="form-select" required></select>
                        </div>
                    </div>
                    <div class="form-group"><label class="form-label">TIME</label>
                        <select id="saju-time" class="form-select" required>
                            <option value="unknown">ì‹œê°„ ëª¨ë¦„</option>
                            <option value="00:30">ìì‹œ (23:30~01:29)</option>
                            <option value="02:30">ì¶•ì‹œ (01:30~03:29)</option>
                            <option value="04:30">ì¸ì‹œ (03:30~05:29)</option>
                            <option value="06:30">ë¬˜ì‹œ (05:30~07:29)</option>
                            <option value="08:30">ì§„ì‹œ (07:30~09:29)</option>
                            <option value="10:30">ì‚¬ì‹œ (09:30~11:29)</option>
                            <option value="12:30">ì˜¤ì‹œ (11:30~13:29)</option>
                            <option value="14:30">ë¯¸ì‹œ (13:30~15:29)</option>
                            <option value="16:30">ì‹ ì‹œ (15:30~17:29)</option>
                            <option value="18:30">ìœ ì‹œ (17:30~19:29)</option>
                            <option value="20:30">ìˆ ì‹œ (19:30~21:29)</option>
                            <option value="22:30">í•´ì‹œ (21:30~23:29)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label"><input type="checkbox" id="saju-privacy" required><span>AGREE TO DATA PROCESSING</span></label>
                    </div>
                    <button type="submit" class="submit-button saju-btn">ACTIVATE ANALYSIS</button>
                </form>
            </div>
        </section>
        
        <section id="astrology-screen" class="screen">
            <button class="back-button" onclick="backToSelection()">â—€ ABORT</button>
            <div class="form-container astro-theme">
                <div class="form-header"><h2 class="form-title">ASTRO SEQUENCE</h2></div>
                <form id="astro-form">
                    <div class="form-group"><label class="form-label">CODENAME</label><input type="text" id="astro-name" class="form-input" required></div>
                    <div class="form-group"><label class="form-label">GENDER</label>
                        <div class="button-group" id="astro-gender-group">
                            <button type="button" class="option-button active" data-value="male">MALE</button>
                            <button type="button" class="option-button" data-value="female">FEMALE</button>
                        </div>
                    </div>
                    <div class="form-group"><label class="form-label">DATE (Solar Only)</label>
                        <div class="select-group">
                            <select id="astro-year" class="form-select" required></select>
                            <select id="astro-month" class="form-select" required></select>
                            <select id="astro-day" class="form-select" required></select>
                        </div>
                        <p class="form-hint">â€» ì ì„±ìˆ ì€ 'ì–‘ë ¥(Solar)' ê¸°ì¤€ì…ë‹ˆë‹¤.</p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">TIME</label>
                        <input type="time" id="astro-time" required style="width: 100%; padding: 12px; background: #000; border: 1px solid #333; color: #fff; outline: none;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">BIRTH LOCATION</label>
                        <input type="text" id="astro-location" class="form-input" placeholder="ì˜ˆ: Seoul, KR ë˜ëŠ” ì„œìš¸" required>
                        <p class="form-hint">â€» ë„ì‹œì™€ êµ­ê°€ëª…ì„ ì…ë ¥í•˜ë©´ ë”ìš± ì •í™•í•œ ë³„ìë¦¬ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label"><input type="checkbox" id="astro-privacy" required><span>AGREE TO DATA PROCESSING</span></label>
                    </div>
                    <button type="submit" class="submit-button astro-btn">ACTIVATE ANALYSIS</button>
                </form>
            </div>
        </section>

        <section id="result-screen" class="screen">
            <div class="hud-interface">
                <div class="hud-corner top-left"></div><div class="hud-corner top-right"></div>
                <div class="hud-corner bottom-left"></div><div class="hud-corner bottom-right"></div>
                <div class="result-header">
                    <h2 class="result-title">ANALYSIS COMPLETE</h2>
                    <button class="new-analysis-button" onclick="backToSelection()">NEW SCAN</button>
                </div>
                <div id="chat-box" class="chat-messages">
                    <div class="ai-message">ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ. ìš´ëª… ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="user-input" class="chat-input" placeholder="ì¶”ê°€ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...">
                    <button id="send-btn" class="send-button">SEND</button>
                </div>
            </div>
        </section>
    </main>
    
    <footer class="site-footer" style="text-align: center; padding: 40px; color: #444; font-family: var(--font-tech); font-size: 0.8rem;">Â© 2026 AI ULTRA DOSA SENTINEL.</footer>

    <script>
        // === 1. ê³„ì‚° ë¡œì§ (ì‚¬ì£¼/ì ì„±ìˆ  ëª¨ë“ˆ) ===
        const HEAVENLY_STEMS = ['ê°‘','ì„','ë³‘','ì •','ë¬´','ê¸°','ê²½','ì‹ ','ì„','ê³„'];
        const EARTHLY_BRANCHES = ['ì','ì¶•','ì¸','ë¬˜','ì§„','ì‚¬','ì˜¤','ë¯¸','ì‹ ','ìœ ','ìˆ ','í•´'];
        const FIVE_ELEMENTS = {
            'ê°‘':'ëª©','ì„':'ëª©','ë³‘':'í™”','ì •':'í™”','ë¬´':'í† ','ê¸°':'í† ','ê²½':'ê¸ˆ','ì‹ ':'ê¸ˆ','ì„':'ìˆ˜','ê³„':'ìˆ˜',
            'ì¸':'ëª©','ë¬˜':'ëª©','ì‚¬':'í™”','ì˜¤':'í™”','ì§„':'í† ','ìˆ ':'í† ','ì¶•':'í† ','ë¯¸':'í† ','ì‹ ':'ê¸ˆ','ìœ ':'ê¸ˆ','ì':'ìˆ˜','í•´':'ìˆ˜'
        };
        const ZODIAC = ['ì–‘','í™©ì†Œ','ìŒë‘¥ì´','ê²Œ','ì‚¬ì','ì²˜ë…€','ì²œì¹­','ì „ê°ˆ','ì‚¬ìˆ˜','ì—¼ì†Œ','ë¬¼ë³‘','ë¬¼ê³ ê¸°'];

        function getPillar(idx, offset) {
            return {
                stem: HEAVENLY_STEMS[(idx + offset) % 10],
                branch: EARTHLY_BRANCHES[(idx + offset) % 12],
                full: HEAVENLY_STEMS[(idx + offset) % 10] + EARTHLY_BRANCHES[(idx + offset) % 12]
            };
        }

        function calculateSaju(y, m, d, h) {
            const yearP = getPillar(y - 4, 0);
            const monthP = getPillar((y - 4) * 12 + m, 2);
            const dayP = getPillar((y * 365 + d), 4);
            const hIdx = (['ì','ì¶•','ì¸','ë¬˜','ì§„','ì‚¬','ì˜¤','ë¯¸','ì‹ ','ìœ ','ìˆ ','í•´'].indexOf(h));
            const hourP = hIdx >= 0 ? getPillar(hIdx, 0) : {full:'ì‹œê°„ëª¨ë¦„'};
            const els = {'ëª©':0,'í™”':0,'í† ':0,'ê¸ˆ':0,'ìˆ˜':0};
            [yearP, monthP, dayP].forEach(p => {
                if(p.stem) els[FIVE_ELEMENTS[p.stem]]++;
                if(p.branch) els[FIVE_ELEMENTS[p.branch]]++;
            });
            return { fourPillars: `${yearP.full} ${monthP.full} ${dayP.full} ${hourP.full}`, dayPillar: dayP, elements: els };
        }

        function calculateAstrology(y, m, d) {
            const sunIdx = (m - 3 + 12) % 12;
            const moonIdx = (d % 27) / 2.5; 
            const ascIdx = (sunIdx + 2) % 12; 
            const getSign = (idx) => ({ name: ZODIAC[Math.floor(idx) % 12] + 'ìë¦¬' });
            return { sun: { sign: getSign(sunIdx) }, moon: { sign: getSign(moonIdx) }, ascendant: { sign: getSign(ascIdx) } };
        }

        // === 2. ë©”ì¸ UI ë¡œì§ ===
        let currentMode = '';
        let currentUserInfo = {};
        let currentRawData = {};

        function selectMethod(method) {
            currentMode = method;
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            if (method === 'saju') document.getElementById('saju-screen').classList.add('active');
            if (method === 'astrology') document.getElementById('astrology-screen').classList.add('active');
        }

        function backToSelection() {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.getElementById('selection-screen').classList.add('active');
            document.getElementById('chat-box').innerHTML = '<div class="ai-message">ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ. ìš´ëª… ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>';
        }

        function showResultScreen() {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.getElementById('result-screen').classList.add('active');
        }

        function appendMessage(sender, text) {
            const chatBox = document.getElementById('chat-box');
            const msgDiv = document.createElement('div');
            msgDiv.className = sender === 'user' ? 'user-message' : 'ai-message';
            msgDiv.innerHTML = text.replace(/\n/g, '<br>');
            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        async function callApi(endpoint, data) {
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                return await response.json();
            } catch (error) {
                return { success: false, error: 'ì„œë²„ í†µì‹  ì˜¤ë¥˜' };
            }
        }

        function setupOptionButtons(id) {
            const group = document.getElementById(id);
            if(!group) return;
            const btns = group.querySelectorAll('.option-button');
            btns.forEach(btn => btn.addEventListener('click', () => {
                btns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }));
        }

        function populateDateSelects() {
            const targetIds = [ { y: 'saju-year', m: 'saju-month', d: 'saju-day' }, { y: 'astro-year', m: 'astro-month', d: 'astro-day' } ];
            targetIds.forEach(target => {
                const ySel = document.getElementById(target.y);
                const mSel = document.getElementById(target.m);
                const dSel = document.getElementById(target.d);
                if(ySel) for(let i=2026; i>=1920; i--) { let opt=document.createElement('option'); opt.value=i; opt.innerHTML=i+"ë…„"; ySel.appendChild(opt); }
                if(mSel) for(let i=1; i<=12; i++) { let opt=document.createElement('option'); opt.value=i; opt.innerHTML=i+"ì›”"; mSel.appendChild(opt); }
                if(dSel) for(let i=1; i<=31; i++) { let opt=document.createElement('option'); opt.value=i; opt.innerHTML=i+"ì¼"; dSel.appendChild(opt); }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            setupOptionButtons('saju-gender-group');
            setupOptionButtons('saju-calendar-group');
            setupOptionButtons('astro-gender-group');
            populateDateSelects();

    
            // [ì‚¬ì£¼ í¼ ì œì¶œ ìˆ˜ì •ë³¸]
            document.getElementById('saju-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!document.getElementById('saju-privacy').checked) { alert('ê°œì¸ì •ë³´ ë™ì˜ í•„ìš”'); return; }

    const name = document.getElementById('saju-name').value;
    const gender = document.querySelector('#saju-gender-group .active').dataset.value;
    
    // â­ ì¤‘ìš”: ìŒë ¥/ì–‘ë ¥ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
    const calendarType = document.querySelector('#saju-calendar-group .active').dataset.value === 'lunar' ? 'ìŒë ¥' : 'ì–‘ë ¥';
    
    const y = document.getElementById('saju-year').value;
    const m = document.getElementById('saju-month').value;
    const d = document.getElementById('saju-day').value;
    const time = document.getElementById('saju-time').value;

    // ì„œë²„ë¡œ ë³´ë‚¼ ë°ì´í„° êµ¬ì¡°í™”
    currentUserInfo = { 
        name, 
        gender: gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±', 
        birthDate: `${y}-${m}-${d}`, 
        birthTime: time, // ì´ì œ "16:30" ê°™ì€ ê°’ì´ ë“¤ì–´ê°
        calendarType: calendarType 
    };

    showResultScreen();
    appendMessage('ai', `ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤... [${calendarType}] ${y}ë…„ ${m}ì›” ${d}ì¼ ì •ë³´ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤.`);
    
    // API í˜¸ì¶œ ì‹œ rawData ì•ˆì— userInfoë¥¼ ë„£ì–´ì„œ ì „ì†¡
    const res = await callApi('/api/saju/consultation', { rawData: { userInfo: currentUserInfo } });
    appendMessage('ai', res.success ? res.consultation : 'ì˜¤ë¥˜ ë°œìƒ: ' + res.error);
});
            //[ì ì„±ìˆ  í¼ ì œì¶œ]
            document.getElementById('astro-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!document.getElementById('astro-privacy').checked) { alert('ê°œì¸ì •ë³´ ë™ì˜ í•„ìš”'); return; }

                const name = document.getElementById('astro-name').value;
                const gender = document.querySelector('#astro-gender-group .active').dataset.value;
                const y = parseInt(document.getElementById('astro-year').value);
                const m = parseInt(document.getElementById('astro-month').value);
                const d = parseInt(document.getElementById('astro-day').value);
                const time = document.getElementById('astro-time').value;
                const location = document.getElementById('astro-location').value; // ìœ„ì¹˜ ë°ì´í„° ìˆ˜ì§‘

                // API ì‹ ë¢°ë„ë¥¼ ìœ„í•´ ë‚ ì§œ íŒ¨ë”© ì²˜ë¦¬ (1 -> 01)
                const fM = m.toString().padStart(2, '0');
                const fD = d.toString().padStart(2, '0');

                currentUserInfo = { name, gender, birthDate: `${y}-${fM}-${fD}`, birthTime: time, location: location };
                const astroResult = calculateAstrology(y, m, d);
                currentRawData = { userInfo: currentUserInfo, astrology: astroResult };
                
                showResultScreen();
                appendMessage('ai', 'ë³„ë“¤ì˜ ìœ„ì¹˜ë¥¼ ê³„ì‚° ì¤‘ì…ë‹ˆë‹¤. ì¶œìƒì§€ ì •ë³´ë¥¼ ì—°ë™í•©ë‹ˆë‹¤...');
                const res = await callApi('/api/astrology/consultation', { rawData: currentRawData });
                appendMessage('ai', res.success ? res.consultation : 'ì˜¤ë¥˜: ' + res.error);
            });

            // [ì±„íŒ… ì „ì†¡]
            document.getElementById('send-btn').addEventListener('click', async () => {
                const input = document.getElementById('user-input');
                const msg = input.value.trim();
                if (!msg) return;
                appendMessage('user', msg);
                input.value = '';
                const endpoint = currentMode === 'saju' ? '/api/saju/chat' : '/api/astrology/chat';
                const res = await callApi(endpoint, { userMessage: msg, rawData: currentRawData });
                appendMessage('ai', res.success ? res.answer : 'ì‘ë‹µ ì‹¤íŒ¨');
            });
        });
    </script>
</body>
</html>